<!DOCTYPE HTML>
<html>
    <head>
        <script>
            const msgHandlerURL = "https://kroljango13.github.io/Web-Stuff/JangoWorker.js";
            let receiver, msgHandler;
            navigator.serviceWorker.register(msgHandlerURL).then(x => msgHandler = x);
            navigator.serviceWorker.onmessage = e => {
                if(e.source.scriptURL === msgHandlerURL){
                    
                }
            }
            function sendMessage(recipientID,msg){
                msgHandler.active.postMessage({
                    to: recipientID,
                    msg: msg,
                    sender: localStorage.displayName||localStorage.clientID,
                    id: localStorage.clientID
                })
            }
            function load(){
                if(!localStorage.clientID){
                    localStorage.setItem("clientID",btoa([...crypto.getRandomValues(new Uint8Array(32))].map(x => String.fromCodePoint(x)).join("")).replaceAll(/[+/=]/g,""))
                }
                if(location.hash != "#" + localStorage.clientID){
                    location.hash = "#" + localStorage.clientID;
                }
                receiver = new BroadcastChannel(localStorage.clientID);
                receiver.addEventListener("message",e => {
                    console.log(`${e.data.sender}:\n${e.data.msg}`);
                    navigator.serviceWorker.getRegistration(msgHandlerURL).then(worker => worker.showNotification("From" + e.data.sender,{body:e.data.msg}))
                })
            }
        </script>
    </head>
    <body onload="load()"></body>
</html>
